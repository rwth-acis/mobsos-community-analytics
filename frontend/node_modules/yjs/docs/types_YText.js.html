

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: types/YText.js | yjs</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
        
            <link type="text/css" rel="stylesheet" href="./style.css">
        
    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="width: 162px; height: 162px">
        
            <a href="/" rel="noopener noreferrer" target="_blank">
                <img src="https://user-images.githubusercontent.com/5553757/48975307-61efb100-f06d-11e8-9177-ee895e5916e5.png" width="100%" height="100%">
            </a>
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">yjs</a></h1>
        
            <span class="version">v13.0.0-76</span>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
        <ol class="lnb-tab">
            <li id="api-tab">
                <a href="#"><h4>API</h4></a>
            </li>
            <li id="examples-tab">
                <a href="#"><h4>Examples</h4></a>
            </li>
        </ol>
    
    <div class="lnb-examples hidden"><h3>Examples</h3><ul><li><a href="tutorial-codemirror.html">CodeMirror Binding</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="codemirror_sub"></div></li><li><a href="tutorial-dom.html">Dom Binding</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="dom_sub"></div></li><li><a href="tutorial-prosemirror.html">ProseMirror Binding</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="prosemirror_sub"></div></li><li><a href="tutorial-quill.html">Quill Binding</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="quill_sub"></div></li><li><a href="tutorial-textarea.html">Textarea Binding</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="textarea_sub"></div></li></ul></div><div class="lnb-api hidden"><h3>Modules</h3><ul><li><a href="module-bindings_dom.html">bindings/dom</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:bindings/dom_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-bindings_dom.html#.defaultFilter">defaultFilter</a></li><li><a href="module-bindings_dom.html#.domToType">domToType</a></li></ul><div class="member-type">Typedef</div><ul class="inner"><li><a href="module-bindings_dom.html#~DomFilter">DomFilter</a></li><li><a href="module-bindings_dom.html#~DomFilter">DomFilter</a></li><li><a href="module-bindings_dom.html#~FilterFunction">FilterFunction</a></li></ul></div></li><li><a href="module-bindings_prosemirror.html">bindings/prosemirror</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:bindings/prosemirror_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-bindings_prosemirror.html#.absolutePositionToRelativePosition">absolutePositionToRelativePosition</a></li><li><a href="module-bindings_prosemirror.html#.createNodeIfNotExists">createNodeIfNotExists</a></li><li><a href="module-bindings_prosemirror.html#.cursorPlugin">cursorPlugin</a></li><li><a href="module-bindings_prosemirror.html#.cursorPluginKey">cursorPluginKey</a></li><li><a href="module-bindings_prosemirror.html#.prosemirrorPlugin">prosemirrorPlugin</a></li><li><a href="module-bindings_prosemirror.html#.prosemirrorPluginKey">prosemirrorPluginKey</a></li><li><a href="module-bindings_prosemirror.html#.relativePositionToAbsolutePosition">relativePositionToAbsolutePosition</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-bindings_prosemirror.html#~matchNodeName">matchNodeName</a></li></ul><div class="member-type">Typedef</div><ul class="inner"><li><a href="module-bindings_prosemirror.html#~ProsemirrorMapping">ProsemirrorMapping</a></li></ul></div></li><li><a href="module-bindings_quill.html">bindings/quill</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:bindings/quill_sub"></div></li><li><a href="module-bindings_textarea.html">bindings/textarea</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:bindings/textarea_sub"></div></li><li><a href="module-provider_websocket.html">provider/websocket</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:provider/websocket_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-provider_websocket.html#~permissionDeniedHandler">permissionDeniedHandler</a></li><li><a href="module-provider_websocket.html#~readMessage">readMessage</a></li></ul></div></li><li><a href="module-provider_websocket_server.html">provider/websocket/server</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:provider/websocket/server_sub"></div></li><li><a href="module-provider_ydb.html">provider/ydb</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:provider/ydb_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-provider_ydb.html#._broadcastYdbCUConfConfirmed">_broadcastYdbCUConfConfirmed</a></li><li><a href="module-provider_ydb.html#._broadcastYdbCUConfCreated">_broadcastYdbCUConfCreated</a></li><li><a href="module-provider_ydb.html#._broadcastYdbRemoteOffsetConfirmed">_broadcastYdbRemoteOffsetConfirmed</a></li><li><a href="module-provider_ydb.html#._broadcastYdbRemoteOffsetReceived">_broadcastYdbRemoteOffsetReceived</a></li><li><a href="module-provider_ydb.html#._broadcastYdbSyncFromServer">_broadcastYdbSyncFromServer</a></li><li><a href="module-provider_ydb.html#._broadcastYdbSyncingRoomsToServer">_broadcastYdbSyncingRoomsToServer</a></li><li><a href="module-provider_ydb.html#.clear">clear</a></li><li><a href="module-provider_ydb.html#.confirmClient">confirmClient</a></li><li><a href="module-provider_ydb.html#.confirmSubscription">confirmSubscription</a></li><li><a href="module-provider_ydb.html#.createSub">createSub</a></li><li><a href="module-provider_ydb.html#.createTransaction">createTransaction</a></li><li><a href="module-provider_ydb.html#.createUpdate">createUpdate</a></li><li><a href="module-provider_ydb.html#.createYdbClient">createYdbClient</a></li><li><a href="module-provider_ydb.html#.get">get</a></li><li><a href="module-provider_ydb.html#.getRoomData">getRoomData</a></li><li><a href="module-provider_ydb.html#.getRoomDataWithoutCU">getRoomDataWithoutCU</a></li><li><a href="module-provider_ydb.html#.getRoomMetas">getRoomMetas</a></li><li><a href="module-provider_ydb.html#.getUnconfirmedUpdates">getUnconfirmedUpdates</a></li><li><a href="module-provider_ydb.html#.openDB">openDB</a></li><li><a href="module-provider_ydb.html#.publishAll">publishAll</a></li><li><a href="module-provider_ydb.html#.publishRoomData">publishRoomData</a></li><li><a href="module-provider_ydb.html#.readMessage">readMessage</a></li><li><a href="module-provider_ydb.html#.send">send</a></li><li><a href="module-provider_ydb.html#.subscribeRoomData">subscribeRoomData</a></li><li><a href="module-provider_ydb.html#.update">update</a></li><li><a href="module-provider_ydb.html#.writeClientUnconfirmed">writeClientUnconfirmed</a></li><li><a href="module-provider_ydb.html#.writeConfirmedByHost">writeConfirmedByHost</a></li><li><a href="module-provider_ydb.html#.writeHostUnconfirmed">writeHostUnconfirmed</a></li><li><a href="module-provider_ydb.html#.writeHostUnconfirmedByClient">writeHostUnconfirmedByClient</a></li><li><a href="module-provider_ydb.html#~datasubs">datasubs</a></li><li><a href="module-provider_ydb.html#~ydbinstances">ydbinstances</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-provider_ydb.html#~checkTestClients">checkTestClients</a></li><li><a href="module-provider_ydb.html#~decodeHUKey">decodeHUKey</a></li><li><a href="module-provider_ydb.html#~encodeHUKey">encodeHUKey</a></li><li><a href="module-provider_ydb.html#~encodeMetaValue">encodeMetaValue</a></li><li><a href="module-provider_ydb.html#~getStoreCo">getStoreCo</a></li><li><a href="module-provider_ydb.html#~getStoreCU">getStoreCU</a></li><li><a href="module-provider_ydb.html#~getStoreHU">getStoreHU</a></li><li><a href="module-provider_ydb.html#~getStoreUS">getStoreUS</a></li><li><a href="module-provider_ydb.html#~getTestClient">getTestClient</a></li><li><a href="module-provider_ydb.html#~initWS">initWS</a></li><li><a href="module-provider_ydb.html#~update">update</a></li></ul><div class="member-type">Typedef</div><ul class="inner"><li><a href="module-provider_ydb.html#~HUTableKey">HUTableKey</a></li><li><a href="module-provider_ydb.html#~RoomAndOffset">RoomAndOffset</a></li><li><a href="module-provider_ydb.html#~RoomMeta">RoomMeta</a></li><li><a href="module-provider_ydb.html#~RoomState">RoomState</a></li><li><a href="module-provider_ydb.html#~Sub">Sub</a></li><li><a href="module-provider_ydb.html#~SubDef">SubDef</a></li><li><a href="module-provider_ydb.html#~SyncState">SyncState</a></li></ul></div></li><li><a href="module-structs.html">structs</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:structs_sub"></div></li><li><a href="module-types.html">types</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types_sub"><div class="member-type">Typedef</div><ul class="inner"><li><a href="module-types.html#~CSS_Selector">CSS_Selector</a></li><li><a href="module-types.html#~CSS_Selector">CSS_Selector</a></li><li><a href="module-types.html#~Delta">Delta</a></li><li><a href="module-types.html#~domFilter">domFilter</a></li><li><a href="module-types.html#~TextAttributes">TextAttributes</a></li></ul></div></li><li><a href="module-utils.html">utils</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:utils_sub"></div></li></ul></div><div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="module-bindings_dom.DomBinding.html">DomBinding</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:bindings/dom.DomBinding_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-bindings_dom.DomBinding.html#domToType">domToType</a></li><li><a href="module-bindings_dom.DomBinding.html#filter">filter</a></li><li><a href="module-bindings_dom.DomBinding.html#target">target</a></li><li><a href="module-bindings_dom.DomBinding.html#type">type</a></li><li><a href="module-bindings_dom.DomBinding.html#typeToDom">typeToDom</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-bindings_dom.DomBinding.html#destroy">destroy</a></li><li><a href="module-bindings_dom.DomBinding.html#setFilter">setFilter</a></li></ul></div></li><li><a href="module-bindings_prosemirror.ProsemirrorBinding.html">ProsemirrorBinding</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:bindings/prosemirror.ProsemirrorBinding_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-bindings_prosemirror.ProsemirrorBinding.html#_relSelection">_relSelection</a></li><li><a href="module-bindings_prosemirror.ProsemirrorBinding.html#mapping">mapping</a></li></ul></div></li><li><a href="module-bindings_quill.QuillBinding.html">QuillBinding</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:bindings/quill.QuillBinding_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-bindings_quill.QuillBinding.html#target">target</a></li><li><a href="module-bindings_quill.QuillBinding.html#type">type</a></li></ul></div></li><li><a href="module-bindings_textarea.CodeMirrorBinding.html">CodeMirrorBinding</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:bindings/textarea.CodeMirrorBinding_sub"></div></li><li><a href="module-bindings_textarea.TextareaBinding.html">TextareaBinding</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:bindings/textarea.TextareaBinding_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-bindings_textarea.TextareaBinding.html#target">target</a></li><li><a href="module-bindings_textarea.TextareaBinding.html#type">type</a></li></ul></div></li><li><a href="module-provider_websocket.WebsocketProvider.html">WebsocketProvider</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:provider/websocket.WebsocketProvider_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-provider_websocket.WebsocketProvider.html#docs">docs</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-provider_websocket.WebsocketProvider.html#get">get</a></li></ul></div></li><li><a href="module-provider_ydb.YdbClient.html">YdbClient</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:provider/ydb.YdbClient_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-provider_ydb.YdbClient.html#clientUnconfirmedStates">clientUnconfirmedStates</a></li><li><a href="module-provider_ydb.YdbClient.html#roomStates">roomStates</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-provider_ydb.YdbClient.html#getY">getY</a></li></ul></div></li><li><a href="module-structs.Type.html">Type</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:structs.Type_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-structs.Type.html#_first">_first</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-structs.Type.html#getPathTo">getPathTo</a></li><li><a href="module-structs.Type.html#observe">observe</a></li><li><a href="module-structs.Type.html#observeDeep">observeDeep</a></li><li><a href="module-structs.Type.html#toJSON">toJSON</a></li><li><a href="module-structs.Type.html#unobserve">unobserve</a></li><li><a href="module-structs.Type.html#unobserveDeep">unobserveDeep</a></li></ul></div></li><li><a href="module-types.YArray.html">YArray</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types.YArray_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-types.YArray.html#delete">delete</a></li><li><a href="module-types.YArray.html#forEach">forEach</a></li><li><a href="module-types.YArray.html#get">get</a></li><li><a href="module-types.YArray.html#insert">insert</a></li><li><a href="module-types.YArray.html#map">map</a></li><li><a href="module-types.YArray.html#push">push</a></li><li><a href="module-types.YArray.html#toArray">toArray</a></li><li><a href="module-types.YArray.html#toJSON">toJSON</a></li></ul></div></li><li><a href="module-types.YArrayEvent.html">YArrayEvent</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types.YArrayEvent_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-types.YArrayEvent.html#addedElements">addedElements</a></li><li><a href="module-types.YArrayEvent.html#removedElements">removedElements</a></li></ul></div></li><li><a href="module-types.YMap.html">YMap</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types.YMap_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-types.YMap.html#delete">delete</a></li><li><a href="module-types.YMap.html#get">get</a></li><li><a href="module-types.YMap.html#has">has</a></li><li><a href="module-types.YMap.html#keys">keys</a></li><li><a href="module-types.YMap.html#set">set</a></li><li><a href="module-types.YMap.html#toJSON">toJSON</a></li></ul></div></li><li><a href="module-types.YMapEvent.html">YMapEvent</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types.YMapEvent_sub"></div></li><li><a href="module-types.YText.html">YText</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types.YText_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-types.YText.html#applyDelta">applyDelta</a></li><li><a href="module-types.YText.html#delete">delete</a></li><li><a href="module-types.YText.html#format">format</a></li><li><a href="module-types.YText.html#insert">insert</a></li><li><a href="module-types.YText.html#insertEmbed">insertEmbed</a></li><li><a href="module-types.YText.html#toDelta">toDelta</a></li><li><a href="module-types.YText.html#toString">toString</a></li></ul></div></li><li><a href="module-types.YXmlElement.html">YXmlElement</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types.YXmlElement_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-types.YXmlElement.html#getAttribute">getAttribute</a></li><li><a href="module-types.YXmlElement.html#getAttributes">getAttributes</a></li><li><a href="module-types.YXmlElement.html#removeAttribute">removeAttribute</a></li><li><a href="module-types.YXmlElement.html#setAttribute">setAttribute</a></li><li><a href="module-types.YXmlElement.html#toDom">toDom</a></li><li><a href="module-types.YXmlElement.html#toDomString">toDomString</a></li></ul></div></li><li><a href="module-types.YXmlEvent.html">YXmlEvent</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types.YXmlEvent_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-types.YXmlEvent.html#_transaction">_transaction</a></li><li><a href="module-types.YXmlEvent.html#attributesChanged">attributesChanged</a></li><li><a href="module-types.YXmlEvent.html#childListChanged">childListChanged</a></li><li><a href="module-types.YXmlEvent.html#remote">remote</a></li></ul></div></li><li><a href="module-types.YXmlFragment.html">YXmlFragment</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types.YXmlFragment_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-types.YXmlFragment.html#createTreeWalker">createTreeWalker</a></li><li><a href="module-types.YXmlFragment.html#querySelector">querySelector</a></li><li><a href="module-types.YXmlFragment.html#querySelectorAll">querySelectorAll</a></li><li><a href="module-types.YXmlFragment.html#toDom">toDom</a></li><li><a href="module-types.YXmlFragment.html#toDomString">toDomString</a></li></ul></div></li><li><a href="module-types.YXmlHook.html">YXmlHook</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types.YXmlHook_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-types.YXmlHook.html#toDom">toDom</a></li></ul></div></li><li><a href="module-types.YXmlText.html">YXmlText</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types.YXmlText_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-types.YXmlText.html#toDom">toDom</a></li></ul></div></li><li><a href="module-types.YXmlTreeWalker.html">YXmlTreeWalker</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types.YXmlTreeWalker_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-types.YXmlTreeWalker.html#next">next</a></li></ul></div></li><li><a href="module-utils.YEvent.html">YEvent</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:utils.YEvent_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-utils.YEvent.html#currentTarget">currentTarget</a></li><li><a href="module-utils.YEvent.html#path">path</a></li><li><a href="module-utils.YEvent.html#target">target</a></li></ul></div></li><li><a href="UndoManager.html">UndoManager</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="UndoManager_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="UndoManager.html#flushChanges">flushChanges</a></li><li><a href="UndoManager.html#redo">redo</a></li><li><a href="UndoManager.html#undo">undo</a></li></ul></div></li><li><a href="Y.html">Y</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Y_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Y.html#define">define</a></li><li><a href="Y.html#destroy">destroy</a></li><li><a href="Y.html#exportModel">exportModel</a></li><li><a href="Y.html#get">get</a></li><li><a href="Y.html#importModel">importModel</a></li><li><a href="Y.html#transact">transact</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3><a href="global.html">Global</a></h3></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module types
 */

import { ItemEmbed } from '../structs/ItemEmbed.js'
import { ItemString } from '../structs/ItemString.js'
import { ItemFormat } from '../structs/ItemFormat.js'
import * as stringify from '../utils/structStringify.js'
import { YArrayEvent, YArray } from './YArray.js'

/**
 * @private
 */
const integrateItem = (item, parent, y, left, right) => {
  item._origin = left
  item._left = left
  item._right = right
  item._right_origin = right
  item._parent = parent
  if (y !== null) {
    item._integrate(y)
  } else if (left === null) {
    parent._start = item
  } else {
    left._right = item
  }
}

/**
 * @private
 */
const findNextPosition = (currentAttributes, parent, left, right, count) => {
  while (right !== null &amp;&amp; count > 0) {
    switch (right.constructor) {
      case ItemEmbed:
      case ItemString:
        const rightLen = right._deleted ? 0 : (right._length - 1)
        if (count &lt;= rightLen) {
          right = right._splitAt(parent._y, count)
          left = right._left
          return [left, right, currentAttributes]
        }
        if (right._deleted === false) {
          count -= right._length
        }
        break
      case ItemFormat:
        if (right._deleted === false) {
          updateCurrentAttributes(currentAttributes, right)
        }
        break
    }
    left = right
    right = right._right
  }
  return [left, right, currentAttributes]
}

/**
 * @private
 */
const findPosition = (parent, index) => {
  let currentAttributes = new Map()
  let left = null
  let right = parent._start
  return findNextPosition(currentAttributes, parent, left, right, index)
}

/**
 * Negate applied formats
 *
 * @private
 */
const insertNegatedAttributes = (y, parent, left, right, negatedAttributes) => {
  // check if we really need to remove attributes
  while (
    right !== null &amp;&amp; (
      right._deleted === true || (
        right.constructor === ItemFormat &amp;&amp;
        (negatedAttributes.get(right.key) === right.value)
      )
    )
  ) {
    if (right._deleted === false) {
      negatedAttributes.delete(right.key)
    }
    left = right
    right = right._right
  }
  for (let [key, val] of negatedAttributes) {
    let format = new ItemFormat()
    format.key = key
    format.value = val
    integrateItem(format, parent, y, left, right)
    left = format
  }
  return [left, right]
}

/**
 * @private
 */
const updateCurrentAttributes = (currentAttributes, item) => {
  const value = item.value
  const key = item.key
  if (value === null) {
    currentAttributes.delete(key)
  } else {
    currentAttributes.set(key, value)
  }
}

/**
 * @private
 */
const minimizeAttributeChanges = (left, right, currentAttributes, attributes) => {
  // go right while attributes[right.key] === right.value (or right is deleted)
  while (true) {
    if (right === null) {
      break
    } else if (right._deleted === true) {
      // continue
    } else if (right.constructor === ItemFormat &amp;&amp; (attributes[right.key] || null) === right.value) {
      // found a format, update currentAttributes and continue
      updateCurrentAttributes(currentAttributes, right)
    } else {
      break
    }
    left = right
    right = right._right
  }
  return [left, right]
}

/**
 * @private
 */
const insertAttributes = (y, parent, left, right, attributes, currentAttributes) => {
  const negatedAttributes = new Map()
  // insert format-start items
  for (let key in attributes) {
    const val = attributes[key]
    const currentVal = currentAttributes.get(key)
    if (currentVal !== val) {
      // save negated attribute (set null if currentVal undefined)
      negatedAttributes.set(key, currentVal || null)
      let format = new ItemFormat()
      format.key = key
      format.value = val
      integrateItem(format, parent, y, left, right)
      left = format
    }
  }
  return [left, right, negatedAttributes]
}

/**
 * @private
 */
const insertText = (y, text, parent, left, right, currentAttributes, attributes) => {
  for (let [key] of currentAttributes) {
    if (attributes[key] === undefined) {
      attributes[key] = null
    }
  }
  [left, right] = minimizeAttributeChanges(left, right, currentAttributes, attributes)
  let negatedAttributes
  [left, right, negatedAttributes] = insertAttributes(y, parent, left, right, attributes, currentAttributes)
  // insert content
  let item
  if (text.constructor === String) {
    item = new ItemString()
    item._content = text
  } else {
    item = new ItemEmbed()
    item.embed = text
  }
  integrateItem(item, parent, y, left, right)
  left = item
  return insertNegatedAttributes(y, parent, left, right, negatedAttributes)
}

/**
 * @private
 */
const formatText = (y, length, parent, left, right, currentAttributes, attributes) => {
  [left, right] = minimizeAttributeChanges(left, right, currentAttributes, attributes)
  let negatedAttributes
  [left, right, negatedAttributes] = insertAttributes(y, parent, left, right, attributes, currentAttributes)
  // iterate until first non-format or null is found
  // delete all formats with attributes[format.key] != null
  while (length > 0 &amp;&amp; right !== null) {
    if (right._deleted === false) {
      switch (right.constructor) {
        case ItemFormat:
          const attr = attributes[right.key]
          if (attr !== undefined) {
            if (attr === right.value) {
              negatedAttributes.delete(right.key)
            } else {
              negatedAttributes.set(right.key, right.value)
            }
            right._delete(y)
          }
          updateCurrentAttributes(currentAttributes, right)
          break
        case ItemEmbed:
        case ItemString:
          right._splitAt(y, length)
          length -= right._length
          break
      }
    }
    left = right
    right = right._right
  }
  return insertNegatedAttributes(y, parent, left, right, negatedAttributes)
}

/**
 * @private
 */
const deleteText = (y, length, parent, left, right, currentAttributes) => {
  while (length > 0 &amp;&amp; right !== null) {
    if (right._deleted === false) {
      switch (right.constructor) {
        case ItemFormat:
          updateCurrentAttributes(currentAttributes, right)
          break
        case ItemEmbed:
        case ItemString:
          right._splitAt(y, length)
          length -= right._length
          right._delete(y)
          break
      }
    }
    left = right
    right = right._right
  }
  return [left, right]
}

// TODO: In the quill delta representation we should also use the format {ops:[..]}
/**
 * The Quill Delta format represents changes on a text document with
 * formatting information. For mor information visit {@link https://quilljs.com/docs/delta/|Quill Delta}
 *
 * @example
 *   {
 *     ops: [
 *       { insert: 'Gandalf', attributes: { bold: true } },
 *       { insert: ' the ' },
 *       { insert: 'Grey', attributes: { color: '#cccccc' } }
 *     ]
 *   }
 *
 * @typedef {Array&lt;Object>} Delta
 */

/**
  * Attributes that can be assigned to a selection of text.
  *
  * @example
  *   {
  *     bold: true,
  *     font-size: '40px'
  *   }
  *
  * @typedef {Object} TextAttributes
  */

/**
 * Event that describes the changes on a YText type.
 *
 * @private
 */
class YTextEvent extends YArrayEvent {
  constructor (ytext, remote, transaction) {
    super(ytext, remote, transaction)
    this._delta = null
  }
  // TODO: Should put this in a separate function. toDelta shouldn't be included
  //       in every Yjs distribution
  /**
   * Compute the changes in the delta format.
   *
   * @return {Delta} A {@link https://quilljs.com/docs/delta/|Quill Delta}) that
   *                 represents the changes on the document.
   *
   * @public
   */
  get delta () {
    if (this._delta === null) {
      const y = this.target._y
      y.transact(() => {
        let item = this.target._start
        const delta = []
        const added = this.addedElements
        const removed = this.removedElements
        this._delta = delta
        let action = null
        let attributes = {} // counts added or removed new attributes for retain
        const currentAttributes = new Map() // saves all current attributes for insert
        const oldAttributes = new Map()
        let insert = ''
        let retain = 0
        let deleteLen = 0
        const addOp = function addOp () {
          if (action !== null) {
            /**
             * @type {any}
             */
            let op
            switch (action) {
              case 'delete':
                op = { delete: deleteLen }
                deleteLen = 0
                break
              case 'insert':
                op = { insert }
                if (currentAttributes.size > 0) {
                  op.attributes = {}
                  for (let [key, value] of currentAttributes) {
                    if (value !== null) {
                      op.attributes[key] = value
                    }
                  }
                }
                insert = ''
                break
              case 'retain':
                op = { retain }
                if (Object.keys(attributes).length > 0) {
                  op.attributes = {}
                  for (let key in attributes) {
                    op.attributes[key] = attributes[key]
                  }
                }
                retain = 0
                break
            }
            delta.push(op)
            action = null
          }
        }
        while (item !== null) {
          switch (item.constructor) {
            case ItemEmbed:
              if (added.has(item)) {
                addOp()
                action = 'insert'
                insert = item.embed
                addOp()
              } else if (removed.has(item)) {
                if (action !== 'delete') {
                  addOp()
                  action = 'delete'
                }
                deleteLen += 1
              } else if (item._deleted === false) {
                if (action !== 'retain') {
                  addOp()
                  action = 'retain'
                }
                retain += 1
              }
              break
            case ItemString:
              if (added.has(item)) {
                if (action !== 'insert') {
                  addOp()
                  action = 'insert'
                }
                insert += item._content
              } else if (removed.has(item)) {
                if (action !== 'delete') {
                  addOp()
                  action = 'delete'
                }
                deleteLen += item._length
              } else if (item._deleted === false) {
                if (action !== 'retain') {
                  addOp()
                  action = 'retain'
                }
                retain += item._length
              }
              break
            case ItemFormat:
              if (added.has(item)) {
                const curVal = currentAttributes.get(item.key) || null
                if (curVal !== item.value) {
                  if (action === 'retain') {
                    addOp()
                  }
                  if (item.value === (oldAttributes.get(item.key) || null)) {
                    delete attributes[item.key]
                  } else {
                    attributes[item.key] = item.value
                  }
                } else {
                  item._delete(y)
                }
              } else if (removed.has(item)) {
                oldAttributes.set(item.key, item.value)
                const curVal = currentAttributes.get(item.key) || null
                if (curVal !== item.value) {
                  if (action === 'retain') {
                    addOp()
                  }
                  attributes[item.key] = curVal
                }
              } else if (item._deleted === false) {
                oldAttributes.set(item.key, item.value)
                const attr = attributes[item.key]
                if (attr !== undefined) {
                  if (attr !== item.value) {
                    if (action === 'retain') {
                      addOp()
                    }
                    if (item.value === null) {
                      attributes[item.key] = item.value
                    } else {
                      delete attributes[item.key]
                    }
                  } else {
                    item._delete(y)
                  }
                }
              }
              if (item._deleted === false) {
                if (action === 'insert') {
                  addOp()
                }
                updateCurrentAttributes(currentAttributes, item)
              }
              break
          }
          item = item._right
        }
        addOp()
        while (this._delta.length > 0) {
          let lastOp = this._delta[this._delta.length - 1]
          if (lastOp.retain !== undefined &amp;&amp; lastOp.attributes === undefined) {
            // retain delta's if they don't assign attributes
            this._delta.pop()
          } else {
            break
          }
        }
      })
    }
    return this._delta
  }
}

/**
 * Type that represents text with formatting information.
 *
 * This type replaces y-richtext as this implementation is able to handle
 * block formats (format information on a paragraph), embeds (complex elements
 * like pictures and videos), and text formats (**bold**, *italic*).
 */
export class YText extends YArray {
  /**
   * @param {String} [string] The initial value of the YText.
   */
  constructor (string) {
    super()
    if (typeof string === 'string') {
      const start = new ItemString()
      start._parent = this
      start._content = string
      this._start = start
    }
  }

  /**
   * Creates YMap Event and calls observers.
   *
   * @private
   */
  _callObserver (transaction, parentSubs, remote) {
    this._callEventHandler(transaction, new YTextEvent(this, remote, transaction))
  }

  toDom () {
    return document.createTextNode(this.toString())
  }

  /**
   * Returns the unformatted string representation of this YText type.
   *
   * @public
   */
  toString () {
    let str = ''
    /**
     * @type {any}
     */
    let n = this._start
    while (n !== null) {
      if (!n._deleted &amp;&amp; n._countable) {
        str += n._content
      }
      n = n._right
    }
    return str
  }

  toDomString () {
    return this.toDelta().map(delta => {
      const nestedNodes = []
      for (let nodeName in delta.attributes) {
        const attrs = []
        for (let key in delta.attributes[nodeName]) {
          attrs.push({key, value: delta.attributes[nodeName][key]})
        }
        // sort attributes to get a unique order
        attrs.sort((a, b) => a.key &lt; b.key ? -1 : 1)
        nestedNodes.push({ nodeName, attrs })
      }
      // sort node order to get a unique order
      nestedNodes.sort((a, b) => a.nodeName &lt; b.nodeName ? -1 : 1)
      // now convert to dom string
      let str = ''
      for (let i = 0; i &lt; nestedNodes.length; i++) {
        const node = nestedNodes[i]
        str += `&lt;${node.nodeName}`
        for (let j = 0; j &lt; node.attrs.length; j++) {
          const attr = node.attrs[i]
          str += ` ${attr.key}="${attr.value}"`
        }
        str += '>'
      }
      str += delta.insert
      for (let i = nestedNodes.length - 1; i >= 0; i--) {
        str += `&lt;/${nestedNodes[i].nodeName}>`
      }
      return str
    })
  }

  /**
   * Apply a {@link Delta} on this shared YText type.
   *
   * @param {Delta} delta The changes to apply on this element.
   *
   * @public
   */
  applyDelta (delta) {
    this._transact(y => {
      let left = null
      let right = this._start
      const currentAttributes = new Map()
      for (let i = 0; i &lt; delta.length; i++) {
        let op = delta[i]
        if (op.insert !== undefined) {
          ;[left, right] = insertText(y, op.insert, this, left, right, currentAttributes, op.attributes || {})
        } else if (op.retain !== undefined) {
          ;[left, right] = formatText(y, op.retain, this, left, right, currentAttributes, op.attributes || {})
        } else if (op.delete !== undefined) {
          ;[left, right] = deleteText(y, op.delete, this, left, right, currentAttributes)
        }
      }
    })
  }

  /**
   * Returns the Delta representation of this YText type.
   *
   * @return {Delta} The Delta representation of this type.
   *
   * @public
   */
  toDelta () {
    let ops = []
    let currentAttributes = new Map()
    let str = ''
    /**
     * @type {any}
     */
    let n = this._start
    function packStr () {
      if (str.length > 0) {
        // pack str with attributes to ops
        let attributes = {}
        let addAttributes = false
        for (let [key, value] of currentAttributes) {
          addAttributes = true
          attributes[key] = value
        }
        let op = { insert: str }
        if (addAttributes) {
          op.attributes = attributes
        }
        ops.push(op)
        str = ''
      }
    }
    while (n !== null) {
      if (!n._deleted) {
        switch (n.constructor) {
          case ItemString:
            str += n._content
            break
          case ItemFormat:
            packStr()
            updateCurrentAttributes(currentAttributes, n)
            break
        }
      }
      n = n._right
    }
    packStr()
    return ops
  }

  /**
   * Insert text at a given index.
   *
   * @param {number} index The index at which to start inserting.
   * @param {String} text The text to insert at the specified position.
   * @param {TextAttributes} attributes Optionally define some formatting
   *                                    information to apply on the inserted
   *                                    Text.
   * @public
   */
  insert (index, text, attributes = {}) {
    if (text.length &lt;= 0) {
      return
    }
    this._transact(y => {
      let [left, right, currentAttributes] = findPosition(this, index)
      insertText(y, text, this, left, right, currentAttributes, attributes)
    })
  }

  /**
   * Inserts an embed at a index.
   *
   * @param {number} index The index to insert the embed at.
   * @param {Object} embed The Object that represents the embed.
   * @param {TextAttributes} attributes Attribute information to apply on the
   *                                    embed
   *
   * @public
   */
  insertEmbed (index, embed, attributes = {}) {
    if (embed.constructor !== Object) {
      throw new Error('Embed must be an Object')
    }
    this._transact(y => {
      let [left, right, currentAttributes] = findPosition(this, index)
      insertText(y, embed, this, left, right, currentAttributes, attributes)
    })
  }

  /**
   * Deletes text starting from an index.
   *
   * @param {number} index Index at which to start deleting.
   * @param {number} length The number of characters to remove. Defaults to 1.
   *
   * @public
   */
  delete (index, length) {
    if (length === 0) {
      return
    }
    this._transact(y => {
      let [left, right, currentAttributes] = findPosition(this, index)
      deleteText(y, length, this, left, right, currentAttributes)
    })
  }

  /**
   * Assigns properties to a range of text.
   *
   * @param {number} index The position where to start formatting.
   * @param {number} length The amount of characters to assign properties to.
   * @param {TextAttributes} attributes Attribute information to apply on the
   *                                    text.
   *
   * @public
   */
  format (index, length, attributes) {
    this._transact(y => {
      let [left, right, currentAttributes] = findPosition(this, index)
      if (right === null) {
        return
      }
      formatText(y, length, this, left, right, currentAttributes, attributes)
    })
  }
  // TODO: De-duplicate code. The following code is in every type.
  /**
   * Transform this YText to a readable format.
   * Useful for logging as all Items implement this method.
   *
   * @private
   */
  _logString () {
    return stringify.logItemHelper('YText', this)
  }
}
</code></pre>
        </article>
    </section>




</div>

<footer>
    <img class="logo" src="https://user-images.githubusercontent.com/5553757/48975307-61efb100-f06d-11e8-9177-ee895e5916e5.png" style="width: 162px; height: 162px">
    <div class="footer-text">Shared Editing</div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
