

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: bindings/dom/DomBinding.js | yjs</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
        
            <link type="text/css" rel="stylesheet" href="./style.css">
        
    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="width: 162px; height: 162px">
        
            <a href="/" rel="noopener noreferrer" target="_blank">
                <img src="https://user-images.githubusercontent.com/5553757/48975307-61efb100-f06d-11e8-9177-ee895e5916e5.png" width="100%" height="100%">
            </a>
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">yjs</a></h1>
        
            <span class="version">v13.0.0-76</span>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
        <ol class="lnb-tab">
            <li id="api-tab">
                <a href="#"><h4>API</h4></a>
            </li>
            <li id="examples-tab">
                <a href="#"><h4>Examples</h4></a>
            </li>
        </ol>
    
    <div class="lnb-examples hidden"><h3>Examples</h3><ul><li><a href="tutorial-codemirror.html">CodeMirror Binding</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="codemirror_sub"></div></li><li><a href="tutorial-dom.html">Dom Binding</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="dom_sub"></div></li><li><a href="tutorial-prosemirror.html">ProseMirror Binding</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="prosemirror_sub"></div></li><li><a href="tutorial-quill.html">Quill Binding</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="quill_sub"></div></li><li><a href="tutorial-textarea.html">Textarea Binding</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="textarea_sub"></div></li></ul></div><div class="lnb-api hidden"><h3>Modules</h3><ul><li><a href="module-bindings_dom.html">bindings/dom</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:bindings/dom_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-bindings_dom.html#.defaultFilter">defaultFilter</a></li><li><a href="module-bindings_dom.html#.domToType">domToType</a></li></ul><div class="member-type">Typedef</div><ul class="inner"><li><a href="module-bindings_dom.html#~DomFilter">DomFilter</a></li><li><a href="module-bindings_dom.html#~DomFilter">DomFilter</a></li><li><a href="module-bindings_dom.html#~FilterFunction">FilterFunction</a></li></ul></div></li><li><a href="module-bindings_prosemirror.html">bindings/prosemirror</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:bindings/prosemirror_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-bindings_prosemirror.html#.absolutePositionToRelativePosition">absolutePositionToRelativePosition</a></li><li><a href="module-bindings_prosemirror.html#.createNodeIfNotExists">createNodeIfNotExists</a></li><li><a href="module-bindings_prosemirror.html#.cursorPlugin">cursorPlugin</a></li><li><a href="module-bindings_prosemirror.html#.cursorPluginKey">cursorPluginKey</a></li><li><a href="module-bindings_prosemirror.html#.prosemirrorPlugin">prosemirrorPlugin</a></li><li><a href="module-bindings_prosemirror.html#.prosemirrorPluginKey">prosemirrorPluginKey</a></li><li><a href="module-bindings_prosemirror.html#.relativePositionToAbsolutePosition">relativePositionToAbsolutePosition</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-bindings_prosemirror.html#~matchNodeName">matchNodeName</a></li></ul><div class="member-type">Typedef</div><ul class="inner"><li><a href="module-bindings_prosemirror.html#~ProsemirrorMapping">ProsemirrorMapping</a></li></ul></div></li><li><a href="module-bindings_quill.html">bindings/quill</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:bindings/quill_sub"></div></li><li><a href="module-bindings_textarea.html">bindings/textarea</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:bindings/textarea_sub"></div></li><li><a href="module-provider_websocket.html">provider/websocket</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:provider/websocket_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-provider_websocket.html#~permissionDeniedHandler">permissionDeniedHandler</a></li><li><a href="module-provider_websocket.html#~readMessage">readMessage</a></li></ul></div></li><li><a href="module-provider_websocket_server.html">provider/websocket/server</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:provider/websocket/server_sub"></div></li><li><a href="module-provider_ydb.html">provider/ydb</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:provider/ydb_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-provider_ydb.html#._broadcastYdbCUConfConfirmed">_broadcastYdbCUConfConfirmed</a></li><li><a href="module-provider_ydb.html#._broadcastYdbCUConfCreated">_broadcastYdbCUConfCreated</a></li><li><a href="module-provider_ydb.html#._broadcastYdbRemoteOffsetConfirmed">_broadcastYdbRemoteOffsetConfirmed</a></li><li><a href="module-provider_ydb.html#._broadcastYdbRemoteOffsetReceived">_broadcastYdbRemoteOffsetReceived</a></li><li><a href="module-provider_ydb.html#._broadcastYdbSyncFromServer">_broadcastYdbSyncFromServer</a></li><li><a href="module-provider_ydb.html#._broadcastYdbSyncingRoomsToServer">_broadcastYdbSyncingRoomsToServer</a></li><li><a href="module-provider_ydb.html#.clear">clear</a></li><li><a href="module-provider_ydb.html#.confirmClient">confirmClient</a></li><li><a href="module-provider_ydb.html#.confirmSubscription">confirmSubscription</a></li><li><a href="module-provider_ydb.html#.createSub">createSub</a></li><li><a href="module-provider_ydb.html#.createTransaction">createTransaction</a></li><li><a href="module-provider_ydb.html#.createUpdate">createUpdate</a></li><li><a href="module-provider_ydb.html#.createYdbClient">createYdbClient</a></li><li><a href="module-provider_ydb.html#.get">get</a></li><li><a href="module-provider_ydb.html#.getRoomData">getRoomData</a></li><li><a href="module-provider_ydb.html#.getRoomDataWithoutCU">getRoomDataWithoutCU</a></li><li><a href="module-provider_ydb.html#.getRoomMetas">getRoomMetas</a></li><li><a href="module-provider_ydb.html#.getUnconfirmedUpdates">getUnconfirmedUpdates</a></li><li><a href="module-provider_ydb.html#.openDB">openDB</a></li><li><a href="module-provider_ydb.html#.publishAll">publishAll</a></li><li><a href="module-provider_ydb.html#.publishRoomData">publishRoomData</a></li><li><a href="module-provider_ydb.html#.readMessage">readMessage</a></li><li><a href="module-provider_ydb.html#.send">send</a></li><li><a href="module-provider_ydb.html#.subscribeRoomData">subscribeRoomData</a></li><li><a href="module-provider_ydb.html#.update">update</a></li><li><a href="module-provider_ydb.html#.writeClientUnconfirmed">writeClientUnconfirmed</a></li><li><a href="module-provider_ydb.html#.writeConfirmedByHost">writeConfirmedByHost</a></li><li><a href="module-provider_ydb.html#.writeHostUnconfirmed">writeHostUnconfirmed</a></li><li><a href="module-provider_ydb.html#.writeHostUnconfirmedByClient">writeHostUnconfirmedByClient</a></li><li><a href="module-provider_ydb.html#~datasubs">datasubs</a></li><li><a href="module-provider_ydb.html#~ydbinstances">ydbinstances</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-provider_ydb.html#~checkTestClients">checkTestClients</a></li><li><a href="module-provider_ydb.html#~decodeHUKey">decodeHUKey</a></li><li><a href="module-provider_ydb.html#~encodeHUKey">encodeHUKey</a></li><li><a href="module-provider_ydb.html#~encodeMetaValue">encodeMetaValue</a></li><li><a href="module-provider_ydb.html#~getStoreCo">getStoreCo</a></li><li><a href="module-provider_ydb.html#~getStoreCU">getStoreCU</a></li><li><a href="module-provider_ydb.html#~getStoreHU">getStoreHU</a></li><li><a href="module-provider_ydb.html#~getStoreUS">getStoreUS</a></li><li><a href="module-provider_ydb.html#~getTestClient">getTestClient</a></li><li><a href="module-provider_ydb.html#~initWS">initWS</a></li><li><a href="module-provider_ydb.html#~update">update</a></li></ul><div class="member-type">Typedef</div><ul class="inner"><li><a href="module-provider_ydb.html#~HUTableKey">HUTableKey</a></li><li><a href="module-provider_ydb.html#~RoomAndOffset">RoomAndOffset</a></li><li><a href="module-provider_ydb.html#~RoomMeta">RoomMeta</a></li><li><a href="module-provider_ydb.html#~RoomState">RoomState</a></li><li><a href="module-provider_ydb.html#~Sub">Sub</a></li><li><a href="module-provider_ydb.html#~SubDef">SubDef</a></li><li><a href="module-provider_ydb.html#~SyncState">SyncState</a></li></ul></div></li><li><a href="module-structs.html">structs</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:structs_sub"></div></li><li><a href="module-types.html">types</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types_sub"><div class="member-type">Typedef</div><ul class="inner"><li><a href="module-types.html#~CSS_Selector">CSS_Selector</a></li><li><a href="module-types.html#~CSS_Selector">CSS_Selector</a></li><li><a href="module-types.html#~Delta">Delta</a></li><li><a href="module-types.html#~domFilter">domFilter</a></li><li><a href="module-types.html#~TextAttributes">TextAttributes</a></li></ul></div></li><li><a href="module-utils.html">utils</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:utils_sub"></div></li></ul></div><div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="module-bindings_dom.DomBinding.html">DomBinding</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:bindings/dom.DomBinding_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-bindings_dom.DomBinding.html#domToType">domToType</a></li><li><a href="module-bindings_dom.DomBinding.html#filter">filter</a></li><li><a href="module-bindings_dom.DomBinding.html#target">target</a></li><li><a href="module-bindings_dom.DomBinding.html#type">type</a></li><li><a href="module-bindings_dom.DomBinding.html#typeToDom">typeToDom</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-bindings_dom.DomBinding.html#destroy">destroy</a></li><li><a href="module-bindings_dom.DomBinding.html#setFilter">setFilter</a></li></ul></div></li><li><a href="module-bindings_prosemirror.ProsemirrorBinding.html">ProsemirrorBinding</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:bindings/prosemirror.ProsemirrorBinding_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-bindings_prosemirror.ProsemirrorBinding.html#_relSelection">_relSelection</a></li><li><a href="module-bindings_prosemirror.ProsemirrorBinding.html#mapping">mapping</a></li></ul></div></li><li><a href="module-bindings_quill.QuillBinding.html">QuillBinding</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:bindings/quill.QuillBinding_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-bindings_quill.QuillBinding.html#target">target</a></li><li><a href="module-bindings_quill.QuillBinding.html#type">type</a></li></ul></div></li><li><a href="module-bindings_textarea.CodeMirrorBinding.html">CodeMirrorBinding</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:bindings/textarea.CodeMirrorBinding_sub"></div></li><li><a href="module-bindings_textarea.TextareaBinding.html">TextareaBinding</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:bindings/textarea.TextareaBinding_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-bindings_textarea.TextareaBinding.html#target">target</a></li><li><a href="module-bindings_textarea.TextareaBinding.html#type">type</a></li></ul></div></li><li><a href="module-provider_websocket.WebsocketProvider.html">WebsocketProvider</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:provider/websocket.WebsocketProvider_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-provider_websocket.WebsocketProvider.html#docs">docs</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-provider_websocket.WebsocketProvider.html#get">get</a></li></ul></div></li><li><a href="module-provider_ydb.YdbClient.html">YdbClient</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:provider/ydb.YdbClient_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-provider_ydb.YdbClient.html#clientUnconfirmedStates">clientUnconfirmedStates</a></li><li><a href="module-provider_ydb.YdbClient.html#roomStates">roomStates</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-provider_ydb.YdbClient.html#getY">getY</a></li></ul></div></li><li><a href="module-structs.Type.html">Type</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:structs.Type_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-structs.Type.html#_first">_first</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-structs.Type.html#getPathTo">getPathTo</a></li><li><a href="module-structs.Type.html#observe">observe</a></li><li><a href="module-structs.Type.html#observeDeep">observeDeep</a></li><li><a href="module-structs.Type.html#toJSON">toJSON</a></li><li><a href="module-structs.Type.html#unobserve">unobserve</a></li><li><a href="module-structs.Type.html#unobserveDeep">unobserveDeep</a></li></ul></div></li><li><a href="module-types.YArray.html">YArray</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types.YArray_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-types.YArray.html#delete">delete</a></li><li><a href="module-types.YArray.html#forEach">forEach</a></li><li><a href="module-types.YArray.html#get">get</a></li><li><a href="module-types.YArray.html#insert">insert</a></li><li><a href="module-types.YArray.html#map">map</a></li><li><a href="module-types.YArray.html#push">push</a></li><li><a href="module-types.YArray.html#toArray">toArray</a></li><li><a href="module-types.YArray.html#toJSON">toJSON</a></li></ul></div></li><li><a href="module-types.YArrayEvent.html">YArrayEvent</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types.YArrayEvent_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-types.YArrayEvent.html#addedElements">addedElements</a></li><li><a href="module-types.YArrayEvent.html#removedElements">removedElements</a></li></ul></div></li><li><a href="module-types.YMap.html">YMap</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types.YMap_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-types.YMap.html#delete">delete</a></li><li><a href="module-types.YMap.html#get">get</a></li><li><a href="module-types.YMap.html#has">has</a></li><li><a href="module-types.YMap.html#keys">keys</a></li><li><a href="module-types.YMap.html#set">set</a></li><li><a href="module-types.YMap.html#toJSON">toJSON</a></li></ul></div></li><li><a href="module-types.YMapEvent.html">YMapEvent</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types.YMapEvent_sub"></div></li><li><a href="module-types.YText.html">YText</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types.YText_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-types.YText.html#applyDelta">applyDelta</a></li><li><a href="module-types.YText.html#delete">delete</a></li><li><a href="module-types.YText.html#format">format</a></li><li><a href="module-types.YText.html#insert">insert</a></li><li><a href="module-types.YText.html#insertEmbed">insertEmbed</a></li><li><a href="module-types.YText.html#toDelta">toDelta</a></li><li><a href="module-types.YText.html#toString">toString</a></li></ul></div></li><li><a href="module-types.YXmlElement.html">YXmlElement</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types.YXmlElement_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-types.YXmlElement.html#getAttribute">getAttribute</a></li><li><a href="module-types.YXmlElement.html#getAttributes">getAttributes</a></li><li><a href="module-types.YXmlElement.html#removeAttribute">removeAttribute</a></li><li><a href="module-types.YXmlElement.html#setAttribute">setAttribute</a></li><li><a href="module-types.YXmlElement.html#toDom">toDom</a></li><li><a href="module-types.YXmlElement.html#toDomString">toDomString</a></li></ul></div></li><li><a href="module-types.YXmlEvent.html">YXmlEvent</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types.YXmlEvent_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-types.YXmlEvent.html#_transaction">_transaction</a></li><li><a href="module-types.YXmlEvent.html#attributesChanged">attributesChanged</a></li><li><a href="module-types.YXmlEvent.html#childListChanged">childListChanged</a></li><li><a href="module-types.YXmlEvent.html#remote">remote</a></li></ul></div></li><li><a href="module-types.YXmlFragment.html">YXmlFragment</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types.YXmlFragment_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-types.YXmlFragment.html#createTreeWalker">createTreeWalker</a></li><li><a href="module-types.YXmlFragment.html#querySelector">querySelector</a></li><li><a href="module-types.YXmlFragment.html#querySelectorAll">querySelectorAll</a></li><li><a href="module-types.YXmlFragment.html#toDom">toDom</a></li><li><a href="module-types.YXmlFragment.html#toDomString">toDomString</a></li></ul></div></li><li><a href="module-types.YXmlHook.html">YXmlHook</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types.YXmlHook_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-types.YXmlHook.html#toDom">toDom</a></li></ul></div></li><li><a href="module-types.YXmlText.html">YXmlText</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types.YXmlText_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-types.YXmlText.html#toDom">toDom</a></li></ul></div></li><li><a href="module-types.YXmlTreeWalker.html">YXmlTreeWalker</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:types.YXmlTreeWalker_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-types.YXmlTreeWalker.html#next">next</a></li></ul></div></li><li><a href="module-utils.YEvent.html">YEvent</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:utils.YEvent_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-utils.YEvent.html#currentTarget">currentTarget</a></li><li><a href="module-utils.YEvent.html#path">path</a></li><li><a href="module-utils.YEvent.html#target">target</a></li></ul></div></li><li><a href="UndoManager.html">UndoManager</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="UndoManager_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="UndoManager.html#flushChanges">flushChanges</a></li><li><a href="UndoManager.html#redo">redo</a></li><li><a href="UndoManager.html#undo">undo</a></li></ul></div></li><li><a href="Y.html">Y</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Y_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Y.html#define">define</a></li><li><a href="Y.html#destroy">destroy</a></li><li><a href="Y.html#exportModel">exportModel</a></li><li><a href="Y.html#get">get</a></li><li><a href="Y.html#importModel">importModel</a></li><li><a href="Y.html#transact">transact</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3><a href="global.html">Global</a></h3></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module bindings/dom
 */

/* global MutationObserver, getSelection */

import { fromRelativePosition } from '../../utils/relativePosition.js'
import { createMutex } from '../../lib/mutex.js'
import { createAssociation, removeAssociation } from './util.js'
import { beforeTransactionSelectionFixer, afterTransactionSelectionFixer, getCurrentRelativeSelection } from './selection.js'
import { defaultFilter, applyFilterOnType } from './filter.js'
import { typeObserver } from './typeObserver.js'
import { domObserver } from './domObserver.js'
import { YXmlFragment } from '../../types/YXmlElement.js' // eslint-disable-line

/**
 * @callback DomFilter
 * @param {string} nodeName
 * @param {Map&lt;string, string>} attrs
 * @return {Map | null}
 */

/**
 * A binding that binds the children of a YXmlFragment to a DOM element.
 *
 * This binding is automatically destroyed when its parent is deleted.
 *
 * @example
 * const div = document.createElement('div')
 * const type = y.define('xml', Y.XmlFragment)
 * const binding = new Y.QuillBinding(type, div)
 *
 * @class
 */
export class DomBinding {
  /**
   * @param {YXmlFragment} type The bind source. This is the ultimate source of
   *                            truth.
   * @param {Element} target The bind target. Mirrors the target.
   * @param {Object} [opts] Optional configurations

   * @param {DomFilter} [opts.filter=defaultFilter] The filter function to use.
   * @param {Document} [opts.document=document] The filter function to use.
   * @param {Object} [opts.hooks] The filter function to use.
   * @param {Element} [opts.scrollingElement=null] The filter function to use.
   */
  constructor (type, target, opts = {}) {
    // Binding handles textType as this.type and domTextarea as this.target
    /**
     * The Yjs type that is bound to `target`
     * @type {YXmlFragment}
     */
    this.type = type
    /**
     * The target that `type` is bound to.
     * @type {Element}
     */
    this.target = target
    /**
     * @private
     */
    this._mutualExclude = createMutex()
    this.opts = opts
    opts.document = opts.document || document
    opts.hooks = opts.hooks || {}
    this.scrollingElement = opts.scrollingElement || null
    /**
     * Maps each DOM element to the type that it is associated with.
     * @type {Map}
     */
    this.domToType = new Map()
    /**
     * Maps each YXml type to the DOM element that it is associated with.
     * @type {Map}
     */
    this.typeToDom = new Map()
    /**
     * Defines which DOM attributes and elements to filter out.
     * Also filters remote changes.
     * @type {DomFilter}
     */
    this.filter = opts.filter || defaultFilter
    // set initial value
    target.innerHTML = ''
    type.forEach(child => {
      target.insertBefore(child.toDom(opts.document, opts.hooks, this), null)
    })
    this._typeObserver = typeObserver.bind(this)
    this._domObserver = mutations => {
      domObserver.call(this, mutations, opts.document)
    }
    type.observeDeep(this._typeObserver)
    this._mutationObserver = new MutationObserver(this._domObserver)
    this._mutationObserver.observe(target, {
      childList: true,
      attributes: true,
      characterData: true,
      subtree: true
    })
    this._currentSel = null
    this._selectionchange = () => {
      this._currentSel = getCurrentRelativeSelection(this)
    }
    document.addEventListener('selectionchange', this._selectionchange)
    const y = type._y
    this.y = y
    // Force flush dom changes before Type changes are applied (they might
    // modify the dom)
    this._beforeTransactionHandler = y => {
      this._domObserver(this._mutationObserver.takeRecords())
      this._mutualExclude(() => {
        beforeTransactionSelectionFixer(this)
      })
    }
    y.on('beforeTransaction', this._beforeTransactionHandler)
    this._afterTransactionHandler = (y, transaction) => {
      this._mutualExclude(() => {
        afterTransactionSelectionFixer(this)
      })
      // remove associations
      // TODO: this could be done more efficiently
      // e.g. Always delete using the following approach, or removeAssociation
      // in dom/type-observer..
      transaction.deletedStructs.forEach(type => {
        const dom = this.typeToDom.get(type)
        if (dom !== undefined) {
          removeAssociation(this, dom, type)
        }
      })
    }
    y.on('afterTransaction', this._afterTransactionHandler)
    // Before calling observers, apply dom filter to all changed and new types.
    this._beforeObserverCallsHandler = (y, transaction) => {
      // Apply dom filter to new and changed types
      transaction.changedTypes.forEach((subs, type) => {
        // Only check attributes. New types are filtered below.
        if ((subs.size > 1 || (subs.size === 1 &amp;&amp; subs.has(null) === false))) {
          applyFilterOnType(y, this, type)
        }
      })
      transaction.newTypes.forEach(type => {
        applyFilterOnType(y, this, type)
      })
    }
    y.on('beforeObserverCalls', this._beforeObserverCallsHandler)
    createAssociation(this, target, type)
  }

  flushDomChanges () {
    this._domObserver(this._mutationObserver.takeRecords())
  }

  /**
   * NOTE:
   * * does not apply filter to existing elements!
   * * only guarantees that changes are filtered locally. Remote sites may see different content.
   *
   * @param {DomFilter} filter The filter function to use from now on.
   */
  setFilter (filter) {
    this.filter = filter
    // TODO: apply filter to all elements
  }

  _getUndoStackInfo () {
    return this.getSelection()
  }

  _restoreUndoStackInfo (info) {
    this.restoreSelection(info)
  }

  getSelection () {
    return this._currentSel
  }

  restoreSelection (selection) {
    if (selection !== null) {
      const { to, from } = selection
      /**
       * There is little information on the difference between anchor/focus and base/extent.
       * MDN doesn't even mention base/extent anymore.. though you still have to call
       * setBaseAndExtent to change the selection..
       * I can observe that base/extend refer to notes higher up in the xml hierachy.
       * Espesially for undo/redo this is preferred. If this becomes a problem in the future,
       * we should probably go back to anchor/focus.
       */
      const browserSelection = getSelection()
      let { baseNode, baseOffset, extentNode, extentOffset } = browserSelection
      if (from !== null) {
        let sel = fromRelativePosition(this.y, from)
        if (sel !== null) {
          let node = this.typeToDom.get(sel.type)
          let offset = sel.offset
          if (node !== baseNode || offset !== baseOffset) {
            baseNode = node
            baseOffset = offset
          }
        }
      }
      if (to !== null) {
        let sel = fromRelativePosition(this.y, to)
        if (sel !== null) {
          let node = this.typeToDom.get(sel.type)
          let offset = sel.offset
          if (node !== extentNode || offset !== extentOffset) {
            extentNode = node
            extentOffset = offset
          }
        }
      }
      browserSelection.setBaseAndExtent(
        baseNode,
        baseOffset,
        extentNode,
        extentOffset
      )
    }
  }

  /**
   * Remove all properties that are handled by this class.
   */
  destroy () {
    this.domToType = null
    this.typeToDom = null
    this.type.unobserveDeep(this._typeObserver)
    this._mutationObserver.disconnect()
    const y = this.type._y
    y.off('beforeTransaction', this._beforeTransactionHandler)
    y.off('beforeObserverCalls', this._beforeObserverCallsHandler)
    y.off('afterTransaction', this._afterTransactionHandler)
    document.removeEventListener('selectionchange', this._selectionchange)
    this.type = null
    this.target = null
  }
}

/**
 * A filter defines which elements and attributes to share.
 * Return null if the node should be filtered. Otherwise return the Map of
 * accepted attributes.
 *
 * @callback FilterFunction
 * @param {string} nodeName
 * @param {Map} attrs
 * @return {Map|null}
 */
</code></pre>
        </article>
    </section>




</div>

<footer>
    <img class="logo" src="https://user-images.githubusercontent.com/5553757/48975307-61efb100-f06d-11e8-9177-ee895e5916e5.png" style="width: 162px; height: 162px">
    <div class="footer-text">Shared Editing</div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
